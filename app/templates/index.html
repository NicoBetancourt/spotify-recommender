<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
    <div class="container mt-5">
        <h1>Spotify Search</h1>

        <form id="searchForm">
            <div class="mb-3">
                <label for="searchInput" class="form-label">Nombre de la canción:</label>
                <input type="text" class="form-control" id="searchInput" name="id" required>
            </div>
            <button type="button" class="btn btn-primary" onclick="searchSpotify()">Search</button>
        </form>

        <div id="results" class="mt-4"></div>
    </div>

    <script>
        function searchSpotify() {
            var id = document.getElementById("searchInput").value;
            var url = "http://localhost:5000/v1/spotify/?track_name=" + id;

            fetch(url)
                .then(response => response.json())
                .then(data => displayResults(filterColumns(data)))
                .catch(error => console.error('Error:', error));
        }

        function filterColumns(dataComplete) {
            data = dataComplete.song;
            console.log("🚀 ~ file: index.html:39 ~ filterColumns ~ data:", data)
            var filteredData = [];
            for (var i = 0; i < data.length; i++) {
                var row = {};
                row["track_name"] = data[i]["track_name"];
                row["track_artist"] = data[i]["track_artist"];
                row["track_album_name"] = data[i]["track_album_name"];
                row["playlist_genre"] = data[i]["playlist_genre"];
                row["track_album_release_date"] = data[i]["track_album_release_date"];
                filteredData.push(row);
            }
            return filteredData;
        }

        function displayResults(data) {
            // data = dataComplete.song;
            var resultsDiv = document.getElementById("results");

            // Limpiar resultados anteriores
            resultsDiv.innerHTML = "";

            // Crear una tabla con estilos de Bootstrap
            var table = document.createElement("table");
            table.classList.add("table", "table-bordered", "table-striped");

            // Crear encabezados de tabla con 6 columnas específicas
            var headerRow = table.insertRow(0);
            var columnHeaders = ["", "Name", "Artista", "Álbum", "Género", "Fecha"];
            for (var i = 0; i < columnHeaders.length; i++) {
                var headerCell = headerRow.insertCell(-1);
                headerCell.textContent = columnHeaders[i];
            }

            // Llenar la tabla con los datos
            for (let i = 0; i < data.length; i++) {
                var row = table.insertRow(-1);

                // Crear botónes de selección y deselección
                var selectCell = row.insertCell(0);
                let selectButton = document.createElement("button");
                let deselectButton = document.createElement("button");

                // Estilo de los botones
                selectButton.classList.add("btn", "btn-success");
                selectButton.textContent = "+";
                selectButton.onclick = function () {
                    // Esconder el botón de selección y mostrar el de deselección
                    selectButton.style.display = "none";   
                    deselectButton.style.display = "block"; 
                    AddSongToPlaylist(data[i]);
                };
                
                deselectButton.classList.add("btn", "btn-danger");
                deselectButton.textContent = "-";
                deselectButton.style.display = "none"; // Empezar escondido
                deselectButton.onclick = function () {
                    // Esconder el botón de deselección y mostrar el de selección
                    deselectButton.style.display = "none";
                    selectButton.style.display = "block";
                    RemoveSongFromPlaylist(data[i]);
                };

                // Tamaño de los botones para que sean iguales
                selectButton.style.width = "100%";
                selectButton.style.height = "auto";

                deselectButton.style.width = "100%";
                deselectButton.style.height = "auto";
                
                // Agregar botones a la primera columna
                selectCell.appendChild(selectButton);
                selectCell.appendChild(deselectButton);

                // Llenar las restantes 5 columnas con datos
                for (var j = 0; j < 5; j++) {
                    var cell = row.insertCell(-1);
                    cell.textContent = data[i][Object.keys(data[i])[j]];
                }
            }

            // Agregar la tabla al div de resultados
            resultsDiv.appendChild(table);
        }
        
        var selectedSongs = {};// Diccionario con las canciones seleccionadas
        /// <summary> Agrerga una canción a la lista de playlist </summary>
        /// <param name="songData"> Datos de la canción a agregar </param>
        function AddSongToPlaylist(songData)
        {
            // Update the playlist table
            UpdatePlaylistTable();
        }

        /// <summary> Elimina una canción de la lista de playlist </summary>
        /// <param name="songData"> Datos de la canción a eliminar </param>
        function RemoveSongFromPlaylist(songData)
        {
            // Update the playlist table
            UpdatePlaylistTable();
        }

        function UpdatePlaylistTable()
        {

        }
    </script>
</body>

</html>
